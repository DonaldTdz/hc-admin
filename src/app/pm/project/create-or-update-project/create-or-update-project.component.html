<div class="padding-bottom-45">
  <div class="modal-header">
    <div class="modal-title">{{title}}</div>
  </div>
  <form nz-form [formGroup]="form" #validateForm="ngForm" class="ant-advanced-search-form" (ngSubmit)="save()"
    *ngIf="project">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" nzRequired [nzXs]="24">项目编号</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <input nz-input formControlName="projectCode" disabled="true" placeholder="请输入联系人"
              [(ngModel)]="project.projectCode" />
            <nz-form-explain *ngIf="(form.get('projectCode')?.dirty && form.get('projectCode')?.errors)
            ">项目编号不能超过50个字符
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" nzRequired [nzXs]="24">项目名称</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <input nz-input formControlName="name" placeholder="请输入项目名称" [(ngModel)]="project.name" />
            <nz-form-explain *ngIf="(form.get('name')?.dirty && form.get('name')?.errors)
            ">项目名称不能为空且不能超过100个字符
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">项目分类</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-select [nzPlaceHolder]="'请选择项目分类'" formControlName="type" [(ngModel)]="project.type"
              [nzShowSearch]="true" style="width:100%;">
              <nz-option *ngFor="let i of typeList" [nzLabel]="i.text" [nzValue]="i.value">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">所属客户</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-select [nzPlaceHolder]="'请选择所属客户'" formControlName="customerId" [(ngModel)]="project.customerId"
              [nzShowSearch]="true" style="width:100%;">
              <nz-option *ngFor="let i of customerList" [nzLabel]="i.text" [nzValue]="+i.value">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">负责人</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-select [nzPlaceHolder]="'请选择负责人'" formControlName="employeeId" [(ngModel)]="project.employeeId"
              [nzShowSearch]="true" style="width:100%;">
              <nz-option *ngFor="let i of employeeList" [nzLabel]="i.text" [nzValue]="i.value">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">所属年</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <input nz-input formControlName="year" placeholder="请输入所属年" [(ngModel)]="project.year" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">开始日期</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-date-picker [nzStyle]='{width:"100%"}' placeholder="请选择开始日期" formControlName="startDate"
              [(ngModel)]="project.startDate"></nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">结束日期</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-date-picker [nzStyle]='{width:"100%"}' placeholder="请选择开始日期" [nzFormat]="yyyy" formControlName="endDate"
              [(ngModel)]="project.endDate">
            </nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">预算金额(元)</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-input-number formControlName="budget" [nzPrecision]='2' style="width:100%" placeholder="请输入预算金额"
              [(ngModel)]="project.budget">
            </nz-input-number>
            <nz-form-explain *ngIf="(form.get('budget')?.dirty && form.get('budget')?.errors)
          ">预算金额不能超过18位
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">项目状态</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-select [nzPlaceHolder]="'请选择项目状态'" formControlName="status" [(ngModel)]="project.status"
              [nzShowSearch]="true" style="width:100%;">
              <nz-option *ngFor="let i of projectStatus" [nzLabel]="i.text" [nzValue]="i.value">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item nzFlex>
          <nz-form-label nz-col class="labelPadding" [nzSm]="8" nzRequired [nzXs]="24">项目模式
          </nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-select formControlName="mode" [nzPlaceHolder]="'请选择项目模式'" [(ngModel)]="project.mode"
              [nzShowSearch]="true" (ngModelChange)="profitRatioWhetherShow()" style="width:100%;">
              <nz-option *ngFor="let i of projectMode" [nzLabel]="i.text" [nzValue]="i.value">
              </nz-option>
            </nz-select>
            <nz-form-explain *ngIf="(form.get('mode')?.dirty && form.get('mode')?.errors)
      ">项目模式不能为空
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12" *ngIf="project.mode=='2'">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">收益比例</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-input-number formControlName="profitRatio" style="width:95%" placeholder="请输入收益比例"
              [(ngModel)]="project.profitRatio">
            </nz-input-number>%
            <nz-form-explain *ngIf="(form.get('profitRatio')?.dirty && form.get('profitRatio')?.errors)
        ">收益比例不能超过18位
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12" *ngIf="project.mode=='3'">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="8" class="labelPadding" [nzXs]="24">过单费用(元)</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-input-number formControlName="billCost" style="width:100%" placeholder="请输入过单费用"
              [(ngModel)]="project.billCost">
            </nz-input-number>
            <nz-form-explain *ngIf="(form.get('billCost')?.dirty && form.get('billCost')?.errors)
            ">过单费用不能超过18位
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="24">
        <nz-form-item nzFlex>
          <nz-form-label nz-col [nzSm]="4" class="labelPadding" [nzXs]="24">项目描述</nz-form-label>
          <nz-form-control [nzSm]="20" class="controlPadding" nzHasFeedback>
            <textarea nz-input rows="2" formControlName="desc" placeholder="请输入项目描述"
              [(ngModel)]="project.desc"></textarea>
            <nz-form-explain *ngIf="(form.get('desc')?.dirty && form.get('desc')?.errors)
          ">备注不能超过250个字符
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div class="modal-footer">
      <button nz-button type="button" [disabled]="saving" (click)="close()">
        {{l("Cancel")}}
      </button>
      <button nz-button [nzType]="'primary'" type="submit" [disabled]="!validateForm.valid||saving">
        保存
      </button>
      <button nz-button type="button" [nzType]="'primary'" [disabled]="!validateForm.valid||saving"
        (click)="preservation()">
        保存并添加明细
      </button>
    </div>
  </form>
</div>