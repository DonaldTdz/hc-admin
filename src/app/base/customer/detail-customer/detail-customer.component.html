<page-header title="{{title}}">
</page-header>
<nz-card [nzBordered]="false">
  <form nz-form [formGroup]="form" #validateForm="ngForm" class="ant-advanced-search-form" (ngSubmit)="save()"
    *ngIf="customer">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="8">
        <nz-form-item nzFlex>
          <nz-form-label [nzSm]="6" class="labelPadding" nzRequired [nzXs]="24">客户名称</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <input nz-input formControlName="name" placeholder="请输入客户名称" [(ngModel)]="customer.name" />
            <nz-form-explain *ngIf="(form.get('name')?.dirty && form.get('name')?.errors)
              ">客户名称不能为空且不能超过50个字符
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item nzFlex>
          <nz-form-label [nzSm]="6" class="labelPadding" [nzXs]="24">客户类型</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-select formControlName="type" [nzPlaceHolder]="'请选择客户类型'" [(ngModel)]="customer.type"
              [nzShowSearch]="true" style="width:100%;">
              <nz-option *ngFor="let i of customerTypes" [nzLabel]="i.text" [nzValue]="i.value">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item nzFlex>
          <nz-form-label [nzSm]="6" class="labelPadding" [nzXs]="24">邮编</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <input nz-input formControlName="zipCode" placeholder="请输入邮编" [(ngModel)]="customer.zipCode" />
            <nz-form-explain *ngIf="(form.get('zipCode')?.dirty && form.get('zipCode')?.errors)
              ">请输入正确的邮编
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="8">
        <nz-form-item nzFlex>
          <nz-form-label [nzSm]="6" class="labelPadding" [nzXs]="24">电话</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <nz-input-number nz-input formControlName="tel" style="width:100%" placeholder="请输入电话"
              [(ngModel)]="customer.tel">
            </nz-input-number>
            <nz-form-explain *ngIf="(form.get('tel')?.dirty && form.get('tel')?.errors)
              ">请输入正确的电话
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item nzFlex>
          <nz-form-label [nzSm]="6" class="labelPadding" [nzXs]="24">地址</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <textarea nz-input rows="2" formControlName="address" placeholder="请输入地址"
              [(ngModel)]="customer.address"></textarea>
            <nz-form-explain *ngIf="(form.get('address')?.dirty && form.get('address')?.errors)
              ">地址不能超过250位
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item nzFlex>
          <nz-form-label [nzSm]="6" class="labelPadding" [nzXs]="24">备注</nz-form-label>
          <nz-form-control [nzSm]="16" class="controlPadding" nzHasFeedback>
            <textarea nz-input rows="2" formControlName="remark" placeholder="请输入备注"
              [(ngModel)]="customer.remark"></textarea>
            <nz-form-explain *ngIf="(form.get('remark')?.dirty && form.get('remark')?.errors)
              ">备注不能超过250位
            </nz-form-explain>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <nz-tabset nzSize="large">
      <!-- <nz-tab nzTitle="客户联系人">
        <app-customer-contact [customerId]="id"></app-customer-contact>
      </nz-tab> -->
      <nz-tab nzTitle="项目列表">
        <ng-template #totalContentMe>共{{query.total}}条</ng-template>
        <nz-table #nzTable [nzData]="query.dataList" [nzFrontPagination]="false" [nzTotal]="query.total"
          [(nzPageIndex)]="query.pageIndex" [(nzPageSize)]="query.pageSize" [nzShowTotal]="totalContentMe"
          [nzShowTotal]="'true'" (nzPageIndexChange)="getProjects()" (nzPageSizeChange)="getProjects()"
          [nzShowSizeChanger]="true">
          <thead nz-thead>
            <tr>
              <th nz-th>
                <span>项目名称</span>
              </th>
              <th nz-th>
                <span>项目模式</span>
              </th>
              <th nz-th>
                <span>项目分类</span>
              </th>
              <th nz-th>
                <span>负责人</span>
              </th>
              <th nz-th style="text-align: right">
                <span>预算金额</span>
              </th>
              <th nz-th style="text-align: center">
                <span>状态</span>
              </th>
            </tr>
          </thead>
          <tbody nz-tbody>
            <tr nz-tbody-tr *ngFor="let item of nzTable.data">
              <td nz-td title="{{item.name}}"><a [routerLink]="['/app/pm/project-detail']"
                  [queryParams]="{id:item.id}">{{item.name | lengthLimit:15}}</a>
              </td>
              <td nz-td>{{item.modeName}}</td>
              <td nz-td>{{item.type}}</td>
              <td nz-td>{{item.projectSalesName}} </td>
              <td nz-td style="text-align: right">{{item.budget}} </td>
              <td nz-td style="text-align: center">
                <nz-badge *ngIf="item.status=='1'" [nzStatus]="'processing'" [nzText]="'线索'"></nz-badge>
                <nz-badge *ngIf="item.status=='2'" [nzStatus]="'color'" [nzStyle]="{'background-color':'#2f54eb'}"
                  [nzText]="'立项'"></nz-badge>
                <nz-badge *ngIf=" item.status=='3'" [nzStatus]="'warning'" [nzText]="'招标'"></nz-badge>
                <nz-badge *ngIf=" item.status=='4'" [nzStatus]="'success'" [nzText]="'执行'"></nz-badge>
                <nz-badge *ngIf=" item.status=='5'" [nzStatus]="'default'" [nzText]="'丢单'"></nz-badge>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </nz-tab>
    </nz-tabset>
    <div class="modal-footer">
      <button nz-button [nzType]="'primary'" type="submit" [disabled]="!validateForm.valid||saving">保存</button>
      <button nz-button type="button" [disabled]="saving" (click)="goBack()">
        返回
      </button>
    </div>
  </form>
</nz-card>
